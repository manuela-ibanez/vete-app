<div class="container py-4"> <!-- Contenedor principal -->
  <h2>Listado de Mascotas</h2>

  <!-- tabla de mascotas -->
  <table class="table">
    <thead>
      <tr>
        <th>ID</th> <!-- Encabezados de la tabla -->
        <th>Nombre</th>
        <th>Clase</th>
        <th>Peso</th>
        <th>Edad</th>
        <th>Dueño</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let mascota of mascotas"> <!-- Se usa container para poder repetir varias filas (<tr>) por cada mascota -->
        <!-- fila de datos de la mascota --> <!--mascota es la variable temporal y mascotas es el array con las mascotas traidas del backend-->
        <tr>
          <td>{{ mascota.id }}</td> <!-- Datos de la mascota -->
          <td>{{ mascota.nombre }}</td>
          <td>{{ mascota.clase }}</td>
          <td>{{ mascota.peso }} kg</td>
          <td>{{ mascota.edad }} años</td>
          <td>
            {{ mascota.usuario?.nombre }}
            {{ mascota.usuario?.apellido }} 
          </td>
          <td>
            <button class="btn btn-editar" (click)="editMascota(mascota.id!)"> <!-- Boton de editar -->
              Editar
            </button>
            <button class="btn btn-danger" (click)="deleteMascota(mascota.id!)"> <!-- Boton de eliminar -->
              Eliminar
            </button>
            </td>
        </tr>
        <!--formulario editar mascotas-->
            <tr *ngIf="mascota.id == editarMascotaId" class="mt-3 border border-secondary">
              <td colspan="6">
              <form (ngSubmit)="updateMascota(updateMascotaForm)" #updateMascotaForm="ngForm" class="p-3">
                <input type="hidden" [(ngModel)]="mascota.id" name="id" />
                <div class="mb-3">
                <label for="nombre" class="form-label">Nombre:</label>
                <input type="text" class="form-control" id="nombre" name="nombre" [(ngModel)]="mascota.nombre"
                  #nombreInput="ngModel"
                  required
                  minlength="2"
                  maxlength="50"
                  [class.is-invalid]="nombreInput.invalid && nombreInput.touched" />
                  <div class="invalid-feedback" *ngIf="nombreInput.invalid && nombreInput.touched">  <!--control de errores -->
                    <small *ngIf="nombreInput.errors?.['required']">El nombre es obligatorio</small>
                  </div>
                </div>
                <div class="mb-3">
                <label for="clase" class="form-label">Clase:</label>
                <input type="text" class="form-control" id="clase" name="clase" [(ngModel)]="mascota.clase"
                  #claseInput="ngModel"
                  required
                  minlength="2"
                  maxlength="30"
                  [class.is-invalid]="claseInput.invalid && claseInput.touched" /><!--da error si el campo es invalido y fue tocado por el usuario-->
                  <div class="invalid-feedback" *ngIf="claseInput.invalid && claseInput.touched"> <!--control de errores -->
                    <small *ngIf="claseInput.errors?.['required']">La clase es obligatoria</small>
                  </div>
                </div>
                <div class="mb-3">
                <label for="peso" class="form-label">Peso:</label>
                <input type="number" class="form-control" id="peso" name="peso" [(ngModel)]="mascota.peso"
                  #pesoInput="ngModel"
                  required
                  min="0.1"
                  max="500"
                  step="0.1"
                  [class.is-invalid]="pesoInput.invalid && pesoInput.touched" /> <!--da error si el campo es invalido y fue tocado por el usuario-->
                <div class="invalid-feedback" *ngIf="pesoInput.invalid && pesoInput.touched"> <!--control de errores -->
                  <small *ngIf="pesoInput.errors?.['required']">El peso es obligatorio</small>
                </div>
                </div>
                <div class="mb-3">
                <label for="edad" class="form-label">Edad:</label>
                <input type="number" class="form-control" id="edad" name="edad" [(ngModel)]="mascota.edad"
                  #edadInput="ngModel"
                  required
                  min="0"
                  max="50"
                  [class.is-invalid]="edadInput.invalid && edadInput.touched" /><!--da error si el campo es invalido y fue tocado por el usuario-->
                <div class="invalid-feedback" *ngIf="edadInput.invalid && edadInput.touched"> <!--control de errores -->
                  <small *ngIf="edadInput.errors?.['required']">La edad es obligatoria</small>
                </div>
                </div>

                <button type="submit" class="btn btn-success">Actualizar</button>
              </form>
            </td>
          </tr>
      </ng-container>
    </tbody>
  </table>

  <!-- FORMULARIO PARA CREAR NUEVA MASCOTA -->
  <div class="card">
    <div class="card-header">
      <h4>Añadir Nueva Mascota</h4>
    </div>
    <div class="card-body">
      <form (ngSubmit)="createMascota(createMascotasForm)" #createMascotasForm="ngForm" class="p-3"> <!--el # le da un nombre al formulario para ver su estado-->
        <div class="col-md-6 mb-3"> <!-- Campo de nombre -->
          <label for="nombre" class="form-label">Nombre *</label> 
          <input type="text" class="form-control" id="nombre" name="nombre" [(ngModel)]="nombre" #nombreInput="ngModel"
              required
              minlength="2"
              maxlength="50"
              [class.is-invalid]="nombreInput.invalid && nombreInput.touched" />
          <div class="invalid-feedback" *ngIf="nombreInput.invalid && nombreInput.touched">  <!--control de errores -->
              <small *ngIf="nombreInput.errors?.['required']">El nombre es obligatorio</small>
              <small *ngIf="nombreInput.errors?.['minlength']">Mínimo 2 caracteres</small>
              <small *ngIf="nombreInput.errors?.['maxlength']">Máximo 50 caracteres</small>
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="clase" class="form-label">Clase *</label> <!-- Campo de clase -->
            <input type="text" class="form-control" id="clase" name="clase" [(ngModel)]="clase" #claseInput="ngModel"
              required
              minlength="2"
              maxlength="30"
              [class.is-invalid]="claseInput.invalid && claseInput.touched" /><!--da error si el campo es invalido y fue tocado por el usuario-->
            <div class="invalid-feedback" *ngIf="claseInput.invalid && claseInput.touched"> <!--control de errores -->
              <small *ngIf="claseInput.errors?.['required']">La clase es obligatoria</small>
              <small *ngIf="claseInput.errors?.['minlength']">Mínimo 2 caracteres</small>
              <small *ngIf="claseInput.errors?.['maxlength']">Máximo 30 caracteres</small>
            </div>
          </div> 

          <div class="col-md-6 mb-3">
            <label for="peso" class="form-label">Peso (kg) *</label> <!-- Campo de peso -->
            <input type="number" class="form-control" id="peso" name="peso" [(ngModel)]="peso" #pesoInput="ngModel"
              required
              min="0.1"
              max="500"
              step="0.1"
              [class.is-invalid]="pesoInput.invalid && pesoInput.touched" /> <!--da error si el campo es invalido y fue tocado por el usuario-->
            <div class="invalid-feedback" *ngIf="pesoInput.invalid && pesoInput.touched"> <!--control de errores -->
              <small *ngIf="pesoInput.errors?.['required']">El peso es obligatorio</small>
              <small *ngIf="pesoInput.errors?.['min']">El peso mínimo es 0.1 kg</small>
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="edad" class="form-label">Edad (años) *</label> <!-- Campo de edad -->
            <input type="number" class="form-control" id="edad" name="edad" [(ngModel)]="edad" #edadInput="ngModel"
              required
              min="0"
              max="50"
              [class.is-invalid]="edadInput.invalid && edadInput.touched" /><!--da error si el campo es invalido y fue tocado por el usuario-->
            <div class="invalid-feedback" *ngIf="edadInput.invalid && edadInput.touched"> <!--control de errores -->
              <small *ngIf="edadInput.errors?.['required']">La edad es obligatoria</small>
              <small *ngIf="edadInput.errors?.['min']">La edad mínima es 0 años</small>
            </div>
          </div>

          <div class="col-md-12 mb-3">
            <label for="usuarioId" class="form-label">Dueño *</label> <!-- Campo de dueño -->
            <select class="form-control" id="usuarioId" name="usuarioId" [(ngModel)]="usuarioId" #usuarioInput="ngModel"
              required
              [class.is-invalid]="usuarioInput.invalid && usuarioInput.touched">
              <option [ngValue]="undefined">Seleccione un usuario</option>
              <option *ngFor="let usuario of usuarios" [ngValue]="usuario.id"> <!--muestra la lista de usuarios--><!--valor que se guarda es el id del dueño-->
                {{ usuario.nombre }} {{ usuario.apellido }}
              </option>
            </select>
            <div class="invalid-feedback" *ngIf="usuarioInput.invalid && usuarioInput.touched"> <!--control de errores -->
              <small *ngIf="usuarioInput.errors?.['required']">Debes seleccionar un dueño</small>
            </div>
          </div>

        <button type="submit" class="btn btn-añadir" [disabled]="createMascotasForm.invalid">Añadir Mascota</button>
      </form> <!--disabled se activa si el formulario es invalido, y el formulario es invalido si cualquiera de los inputs lo es-->
  </div>